<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de NavegaÃ§Ã£o - Projetos</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .status {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 12px;
        border-radius: 8px;
      }
      .success {
        background: #dcfce7;
        color: #166534;
      }
      .error {
        background: #fef2f2;
        color: #dc2626;
      }
      .warning {
        background: #fef3c7;
        color: #d97706;
      }
      .info {
        background: #dbeafe;
        color: #1d4ed8;
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      #results {
        margin-top: 20px;
        padding: 20px;
        background: #f1f5f9;
        border-radius: 8px;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        font-size: 14px;
      }
      .iframe-container {
        margin: 20px 0;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª Teste de NavegaÃ§Ã£o - Projetos EPU</h1>

      <div class="status info">
        <span
          >ğŸ” Este teste verifica se a navegaÃ§Ã£o dos cards de projetos estÃ¡
          funcionando corretamente</span
        >
      </div>

      <div style="margin: 20px 0">
        <button class="test-btn" onclick="testProjectsAPI()">
          ğŸ”§ Testar API de Projetos
        </button>
        <button class="test-btn" onclick="openProjectsPage()">
          ğŸ“‹ Abrir PÃ¡gina de Projetos
        </button>
        <button class="test-btn" onclick="testNavigation()">
          ğŸ”— Testar NavegaÃ§Ã£o
        </button>
        <button class="test-btn" onclick="clearResults()">
          ğŸ§¹ Limpar Resultados
        </button>
      </div>

      <div id="results">
        Clique em um dos botÃµes acima para iniciar o teste...
      </div>

      <div class="iframe-container" id="iframe-container" style="display: none">
        <iframe id="test-frame" src="about:blank"></iframe>
      </div>
    </div>

    <script>
      const results = document.getElementById('results');
      const iframe = document.getElementById('test-frame');
      const iframeContainer = document.getElementById('iframe-container');

      function log(message) {
        results.textContent +=
          new Date().toLocaleTimeString() + ' - ' + message + '\n';
        results.scrollTop = results.scrollHeight;
      }

      function clearResults() {
        results.textContent = 'Resultados limpos...\n';
        iframeContainer.style.display = 'none';
      }

      async function testProjectsAPI() {
        log('ğŸ”§ Iniciando teste da API de projetos...');

        try {
          // Primeiro, tentar obter um token
          log('ğŸ“‹ Fazendo login para obter token...');
          const loginResponse = await fetch(
            'http://localhost:4000/api/auth/login',
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                email: 'admin@epu.com',
                password: 'admin123',
              }),
            }
          );

          if (!loginResponse.ok) {
            throw new Error(`Login falhou: ${loginResponse.status}`);
          }

          const loginData = await loginResponse.json();
          const token = loginData.data?.token || loginData.token;

          if (!token) {
            throw new Error('Token nÃ£o recebido do login');
          }

          log('âœ… Login bem-sucedido, token obtido');

          // Testar a API de projetos
          log('ğŸ“Š Buscando projetos...');
          const projectsResponse = await fetch(
            'http://localhost:4000/api/projects',
            {
              headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
              },
            }
          );

          if (!projectsResponse.ok) {
            throw new Error(
              `API de projetos falhou: ${projectsResponse.status}`
            );
          }

          const projectsData = await projectsResponse.json();
          const projects =
            projectsData.data?.data ||
            projectsData.data?.projects ||
            projectsData.projects ||
            [];

          log(`âœ… API funcionando - ${projects.length} projetos encontrados`);

          if (projects.length > 0) {
            log(
              `ğŸ“ Primeiro projeto: ${projects[0].name || projects[0].title || 'Sem nome'}`
            );
            log(`ğŸ†” ID: ${projects[0]._id || projects[0].id || 'Sem ID'}`);
          }

          // Armazenar token para outros testes
          localStorage.setItem('token', token);
          log('ğŸ’¾ Token salvo no localStorage para prÃ³ximos testes');
        } catch (error) {
          log(`âŒ Erro no teste da API: ${error.message}`);
        }
      }

      function openProjectsPage() {
        log('ğŸ“‹ Abrindo pÃ¡gina de projetos no iframe...');
        iframeContainer.style.display = 'block';
        iframe.src = 'http://localhost:3000/projetos';

        iframe.onload = () => {
          log('âœ… PÃ¡gina de projetos carregada no iframe');
          log('ğŸ‘€ Verifique visualmente se os cards aparecem no iframe acima');
        };

        iframe.onerror = () => {
          log('âŒ Erro ao carregar pÃ¡gina de projetos');
        };
      }

      async function testNavigation() {
        log('ğŸ”— Testando navegaÃ§Ã£o...');

        // Verificar se o frontend estÃ¡ rodando
        try {
          const response = await fetch('http://localhost:3000');
          if (!response.ok) {
            throw new Error('Frontend nÃ£o estÃ¡ respondendo');
          }
          log('âœ… Frontend estÃ¡ rodando');
        } catch (error) {
          log(`âŒ Frontend nÃ£o acessÃ­vel: ${error.message}`);
          return;
        }

        // InstruÃ§Ãµes para teste manual
        log('ğŸ“‹ TESTE MANUAL DE NAVEGAÃ‡ÃƒO:');
        log('1. Abra http://localhost:3000/projetos em uma nova aba');
        log('2. Verifique se os cards de projetos aparecem');
        log('3. Clique em qualquer card de projeto');
        log('4. Verifique se navega para /projetos/:id');
        log('5. Verifique se a pÃ¡gina de detalhamento carrega');
        log('');
        log('ğŸ’¡ Dica: Abra o DevTools (F12) para ver logs do console');

        // Abrir em nova aba
        window.open('http://localhost:3000/projetos', '_blank');
      }

      // Auto-teste quando a pÃ¡gina carregar
      window.onload = () => {
        log('ğŸš€ PÃ¡gina de teste carregada');
        log(
          'ğŸ“ Use os botÃµes acima para testar diferentes aspectos do sistema'
        );
      };
    </script>
  </body>
</html>
