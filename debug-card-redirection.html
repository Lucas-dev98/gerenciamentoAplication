<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Redirecionamento - Projetos</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
        font-weight: 500;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      .success {
        background: #10b981;
      }
      .success:hover {
        background: #059669;
      }
      .warning {
        background: #f59e0b;
      }
      .warning:hover {
        background: #d97706;
      }
      .danger {
        background: #ef4444;
      }
      .danger:hover {
        background: #dc2626;
      }
      .log {
        background: #1e293b;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        max-height: 400px;
        overflow-y: auto;
        margin: 20px 0;
      }
      .status {
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
      }
      .info {
        background: #dbeafe;
        color: #1e40af;
      }
      .success-status {
        background: #d1fae5;
        color: #065f46;
      }
      .error {
        background: #fee2e2;
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Debug: Redirecionamento dos Cards de Projetos</h1>

      <div class="status error">
        <span
          >üö® PROBLEMA: Clique no card redireciona para p√°gina inicial em vez da
          p√°gina de detalhes</span
        >
      </div>

      <div style="margin: 20px 0">
        <button class="test-btn" onclick="setupAuth()">
          üîë 1. Configurar Auth
        </button>
        <button class="test-btn" onclick="checkAuthState()">
          üîç 2. Verificar Estado Auth
        </button>
        <button class="test-btn warning" onclick="testDirectNavigation()">
          üîó 3. Testar Nav Direta
        </button>
        <button class="test-btn success" onclick="debugCardClick()">
          üéØ 4. Debug Clique Card
        </button>
        <button class="test-btn danger" onclick="clearAll()">
          üßπ Limpar Tudo
        </button>
      </div>

      <div class="log" id="log"></div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${timestamp}] ${message}\n`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function setupAuth() {
        log('üîë Configurando autentica√ß√£o...');

        localStorage.clear();

        // Token fresco
        const token =
          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NjdlMjc4NGQ4MTcxMjg4NTkyMjVmNSIsImlhdCI6MTc1MjE0ODg3NywiZXhwIjoxNzUyMjM1Mjc3fQ._FWr4FcTwmGVy0PP69ndbYMRF8bFEHm03unq4TAEFxsU';
        const user = {
          _id: '6867e2784d817128859225f5',
          email: 'l.o.bastos@live.com',
          nome: 'Lucas Bastos',
          tipo: 'administrador',
        };

        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(user));

        log('‚úÖ Token configurado');
        log('‚úÖ Usu√°rio configurado');
        log('üìã Para verificar: abra F12 ‚Üí Application ‚Üí Local Storage');
      }

      function checkAuthState() {
        log('üîç Verificando estado de autentica√ß√£o...');

        const token = localStorage.getItem('token');
        const userStr = localStorage.getItem('user');

        log(`üé´ Token presente: ${token ? 'SIM' : 'N√ÉO'}`);
        log(`üë§ User presente: ${userStr ? 'SIM' : 'N√ÉO'}`);

        if (token) {
          log(`üîó Token: ${token.substring(0, 50)}...`);
        }

        if (userStr) {
          try {
            const user = JSON.parse(userStr);
            log(`üìß Email: ${user.email}`);
            log(`üè∑Ô∏è Nome: ${user.nome}`);
          } catch (e) {
            log('‚ùå Erro ao parsear user JSON');
          }
        }
      }

      function testDirectNavigation() {
        log('üîó Testando navega√ß√£o direta...');

        const projectId = '686beb60a09e4125315916e5';
        const directUrl = `http://localhost:3000/projetos/${projectId}`;

        log(`üìç Navegando para: ${directUrl}`);
        window.open(directUrl, '_blank');
        log(
          '‚úÖ Nova aba aberta - verifique se carrega a p√°gina de detalhes ou redireciona'
        );
      }

      function debugCardClick() {
        log('üéØ Iniciando debug do clique no card...');

        // Abrir p√°gina de projetos
        const projectsUrl = 'http://localhost:3000/projetos';
        log(`üìã Abrindo: ${projectsUrl}`);

        const newWindow = window.open(projectsUrl, '_blank');

        if (newWindow) {
          log('‚úÖ Nova janela aberta');
          log('');
          log('üîß INSTRU√á√ïES PARA DEBUG:');
          log('1. Na nova janela, abra F12 (DevTools)');
          log('2. No console, cole este c√≥digo:');
          log('');
          log('--- C√ìDIGO PARA COLAR ---');
          log('// Configurar auth na nova janela');
          log(
            `localStorage.setItem('token', '${localStorage.getItem('token')}');`
          );
          log(
            `localStorage.setItem('user', '${localStorage.getItem('user')}');`
          );
          log('');
          log('// Recarregar para aplicar auth');
          log('window.location.reload();');
          log('');
          log('// Ap√≥s recarregar, colar este c√≥digo para debug:');
          log('setTimeout(() => {');
          log('  console.log("üîç Procurando cards...");');
          log(
            '  const cards = document.querySelectorAll(\'[style*="cursor: pointer"]\');'
          );
          log('  console.log(`üìä Cards encontrados: ${cards.length}`);');
          log('  ');
          log('  if (cards.length > 0) {');
          log('    const firstCard = cards[0];');
          log('    firstCard.style.border = "3px solid #ef4444";');
          log(
            '    firstCard.style.boxShadow = "0 0 0 3px rgba(239, 68, 68, 0.3)";'
          );
          log('    ');
          log('    firstCard.addEventListener("click", function(e) {');
          log('      console.log("üñ±Ô∏è CLIQUE DETECTADO!");');
          log('      console.log("üìç URL antes:", window.location.href);');
          log('      ');
          log('      setTimeout(() => {');
          log('        console.log("üìç URL depois:", window.location.href);');
          log(
            '        if (window.location.href.includes("/projetos/") && window.location.href !== "http://localhost:3000/projetos") {'
          );
          log('          console.log("‚úÖ NAVEGA√á√ÉO FUNCIONOU!");');
          log('        } else {');
          log(
            '          console.log("‚ùå NAVEGA√á√ÉO FALHOU - foi para:", window.location.href);'
          );
          log('        }');
          log('      }, 1000);');
          log('    });');
          log('    ');
          log(
            '    console.log("üî¥ Card destacado em vermelho - CLIQUE NELE!");'
          );
          log('  } else {');
          log('    console.log("‚ùå Nenhum card encontrado");');
          log('  }');
          log('}, 3000);');
          log('--- FIM DO C√ìDIGO ---');
          log('');
          log('3. Aguarde 3 segundos e clique no card vermelho');
          log('4. Observe os logs no console');
        } else {
          log('‚ùå N√£o foi poss√≠vel abrir nova janela');
        }
      }

      function clearAll() {
        log('üßπ Limpando tudo...');
        localStorage.clear();
        log('‚úÖ localStorage limpo');
      }

      // Log inicial
      log('üîç DEBUG: REDIRECIONAMENTO DOS CARDS DE PROJETOS');
      log('================================================');
      log('');
      log(
        'üéØ OBJETIVO: Descobrir por que o clique no card n√£o navega para detalhes'
      );
      log('');
      log('üìã PASSOS:');
      log('1. Configurar autentica√ß√£o');
      log('2. Verificar estado da auth');
      log('3. Testar navega√ß√£o direta');
      log('4. Debugar clique no card');
      log('');
      log('üí° HIP√ìTESES:');
      log('- ProtectedRoute redirecionando por auth inv√°lida');
      log('- React Router n√£o reconhecendo a rota');
      log('- Conflito de eventos JavaScript');
      log('- AuthContext perdendo estado na navega√ß√£o');
      log('');
    </script>
  </body>
</html>
