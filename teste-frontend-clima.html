<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste API Clima - Frontend</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }
      .result {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        font-family: monospace;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background: #45a049;
      }
      .error {
        background: rgba(255, 0, 0, 0.2);
        border: 1px solid #ff6b6b;
      }
      .success {
        background: rgba(0, 255, 0, 0.2);
        border: 1px solid #51cf66;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üå§Ô∏è Teste API de Clima - Frontend</h1>

      <div>
        <button onclick="testDirectAPI()">üîß Teste API Direta</button>
        <button onclick="testWeatherService()">‚öôÔ∏è Teste Weather Service</button>
        <button onclick="testGeolocation()">üìç Teste Geolocaliza√ß√£o</button>
        <button onclick="testEnvironment()">üîë Verificar Environment</button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      const API_KEY = '3a13a8fb98632d1c05d5aecb16a6a866';
      const SAO_PAULO_LAT = -23.5505;
      const SAO_PAULO_LON = -46.6333;

      function addResult(title, content, isError = false) {
        const results = document.getElementById('results');
        const div = document.createElement('div');
        div.className = `result ${isError ? 'error' : 'success'}`;
        div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
        results.appendChild(div);
      }

      function clearResults() {
        document.getElementById('results').innerHTML = '';
      }

      async function testDirectAPI() {
        clearResults();
        addResult('üîß Teste API Direta', 'Testando chamada direta √† API...');

        try {
          const url = `https://api.openweathermap.org/data/2.5/weather?lat=${SAO_PAULO_LAT}&lon=${SAO_PAULO_LON}&appid=${API_KEY}&units=metric&lang=pt_br`;

          const response = await fetch(url);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          addResult(
            '‚úÖ API Direta - SUCESSO',
            `
üå°Ô∏è Temperatura: ${Math.round(data.main.temp)}¬∞C
üìç Cidade: ${data.name}
‚òÅÔ∏è Descri√ß√£o: ${data.weather[0].description}
üí® Vento: ${Math.round(data.wind.speed * 3.6)} km/h
üíß Umidade: ${data.main.humidity}%

üìã Dados completos:
${JSON.stringify(data, null, 2)}
                `
          );
        } catch (error) {
          addResult(
            '‚ùå API Direta - ERRO',
            `
Erro: ${error.message}
Stack: ${error.stack || 'N/A'}
                `,
            true
          );
        }
      }

      async function testWeatherService() {
        addResult(
          '‚öôÔ∏è Teste Weather Service',
          'Verificando se weatherService est√° dispon√≠vel...'
        );

        // Verificar se o weatherService est√° dispon√≠vel no contexto global
        if (typeof window.weatherService === 'undefined') {
          addResult(
            '‚ùå Weather Service - N√ÉO ENCONTRADO',
            `
O weatherService n√£o est√° dispon√≠vel no contexto global.
Isso indica que o m√≥dulo n√£o foi carregado corretamente.

Verifica√ß√µes necess√°rias:
1. Build do frontend executado corretamente
2. Imports funcionando
3. Sem erros de TypeScript
                `,
            true
          );
          return;
        }

        try {
          const response =
            await window.weatherService.getCurrentWeatherByCoords(
              SAO_PAULO_LAT,
              SAO_PAULO_LON
            );

          if (response.success) {
            addResult(
              '‚úÖ Weather Service - SUCESSO',
              `
üå°Ô∏è Temperatura: ${response.data.temperature}¬∞C
üìç Localiza√ß√£o: ${response.data.location}
‚òÅÔ∏è Descri√ß√£o: ${response.data.description}
üåü √çcone: ${response.data.icon}
üí® Vento: ${response.data.windSpeed} km/h
üíß Umidade: ${response.data.humidity}%

üìã Response completa:
${JSON.stringify(response, null, 2)}
                    `
            );
          } else {
            addResult(
              '‚ùå Weather Service - FALHA',
              `
Success: ${response.success}
Message: ${response.message}
                    `,
              true
            );
          }
        } catch (error) {
          addResult(
            '‚ùå Weather Service - ERRO',
            `
Erro: ${error.message}
Stack: ${error.stack || 'N/A'}
                `,
            true
          );
        }
      }

      function testGeolocation() {
        addResult(
          'üìç Teste Geolocaliza√ß√£o',
          'Verificando suporte √† geolocaliza√ß√£o...'
        );

        if (!navigator.geolocation) {
          addResult(
            '‚ùå Geolocaliza√ß√£o - N√ÉO SUPORTADA',
            'Navegador n√£o suporta geolocaliza√ß√£o',
            true
          );
          return;
        }

        addResult(
          '‚úÖ Geolocaliza√ß√£o - SUPORTADA',
          `
Navigator.geolocation dispon√≠vel: ${!!navigator.geolocation}

Nota: Para testar a obten√ß√£o da localiza√ß√£o real, 
use o bot√£o "üìç Usar Minha Localiza√ß√£o" no dashboard.
            `
        );
      }

      function testEnvironment() {
        addResult(
          'üîë Verifica√ß√£o Environment',
          'Verificando configura√ß√µes de ambiente...'
        );

        const checks = {
          'API_KEY hardcoded': API_KEY,
          HTTPS: location.protocol === 'https:',
          Localhost:
            location.hostname === 'localhost' ||
            location.hostname === '127.0.0.1',
          'User Agent': navigator.userAgent,
          'Fetch dispon√≠vel': typeof fetch !== 'undefined',
          'Promise dispon√≠vel': typeof Promise !== 'undefined',
        };

        let result = '';
        for (const [key, value] of Object.entries(checks)) {
          result += `${key}: ${value}\n`;
        }

        addResult('üìã Environment Info', result);
      }

      // Adicionar weatherService ao contexto global para teste (simula√ß√£o)
      window.weatherService = {
        getCurrentWeatherByCoords: async (lat, lon) => {
          // Simular o comportamento do weatherService real
          const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=pt_br`;

          const response = await fetch(url);
          if (!response.ok) {
            throw new Error('Falha ao obter dados do clima');
          }

          const data = await response.json();

          const iconMap = {
            '01d': '‚òÄÔ∏è',
            '01n': 'üåô',
            '02d': '‚õÖ',
            '02n': '‚òÅÔ∏è',
            '03d': '‚òÅÔ∏è',
            '03n': '‚òÅÔ∏è',
            '04d': '‚òÅÔ∏è',
            '04n': '‚òÅÔ∏è',
            '09d': 'üåßÔ∏è',
            '09n': 'üåßÔ∏è',
            '10d': 'üå¶Ô∏è',
            '10n': 'üåßÔ∏è',
            '11d': '‚õàÔ∏è',
            '11n': '‚õàÔ∏è',
            '13d': '‚ùÑÔ∏è',
            '13n': '‚ùÑÔ∏è',
            '50d': 'üå´Ô∏è',
            '50n': 'üå´Ô∏è',
          };

          const weatherData = {
            temperature: Math.round(data.main.temp),
            description: data.weather[0].description,
            icon: iconMap[data.weather[0].icon] || 'üå§Ô∏è',
            location: `${data.name}, ${data.sys.country}`,
            humidity: data.main.humidity,
            windSpeed: Math.round(data.wind.speed * 3.6),
            feelsLike: Math.round(data.main.feels_like),
            pressure: data.main.pressure,
            visibility: Math.round(data.visibility / 1000),
            uvIndex: 0,
            dewPoint: Math.round(
              data.main.temp - (100 - data.main.humidity) / 5
            ),
            clouds: data.clouds.all,
            windDeg: data.wind.deg || 0,
            windGust: data.wind.gust
              ? Math.round(data.wind.gust * 3.6)
              : undefined,
            sunrise: data.sys.sunrise,
            sunset: data.sys.sunset,
          };

          return {
            data: weatherData,
            success: true,
            message: 'Dados do clima obtidos com sucesso',
          };
        },
      };

      // Executar teste autom√°tico ao carregar
      window.addEventListener('load', () => {
        addResult(
          'üöÄ Sistema Carregado',
          'P√°gina de teste carregada. Clique nos bot√µes para testar.'
        );
      });
    </script>
  </body>
</html>
