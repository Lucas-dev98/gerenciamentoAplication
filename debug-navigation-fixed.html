<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug - Navegação dos Projetos</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      .test-btn.success {
        background: #059669;
      }
      .test-btn.warning {
        background: #d97706;
      }
      #results {
        margin-top: 20px;
        padding: 20px;
        background: #f1f5f9;
        border-radius: 8px;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        max-height: 300px;
        overflow-y: auto;
      }
      .iframe-container {
        margin: 20px 0;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 700px;
        border: none;
      }
      .split-view {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🔧 Debug - Navegação dos Projetos</h1>

      <div style="margin: 20px 0">
        <button class="test-btn" onclick="loadProjectsPage()">
          📋 Carregar Página de Projetos
        </button>
        <button class="test-btn warning" onclick="injectDebugScript()">
          🔧 Injetar Debug Script
        </button>
        <button class="test-btn success" onclick="testNavigation()">
          🔗 Testar Navegação Manual
        </button>
        <button class="test-btn" onclick="clearResults()">🧹 Limpar</button>
      </div>

      <div class="split-view">
        <div>
          <h3>📊 Log de Debug</h3>
          <div id="results">
            Clique em 'Carregar Página de Projetos' para começar...
          </div>
        </div>

        <div>
          <h3>📋 Instruções</h3>
          <div
            style="
              background: #fff3cd;
              padding: 15px;
              border-radius: 8px;
              font-size: 14px;
            "
          >
            <strong>1. Carregar Página:</strong> Clique em "Carregar Página de
            Projetos"<br /><br />
            <strong>2. Aguardar:</strong> Espere os cards carregarem no
            iframe<br /><br />
            <strong>3. Debug:</strong> Clique em "Injetar Debug Script"<br /><br />
            <strong>4. Testar:</strong> Clique em um card no iframe<br /><br />
            <strong>5. Verificar:</strong> Veja os logs no console (F12)
          </div>
        </div>
      </div>

      <div class="iframe-container" id="iframe-container" style="display: none">
        <iframe id="test-frame" src="about:blank"></iframe>
      </div>
    </div>

    <script>
      const results = document.getElementById('results');
      const iframe = document.getElementById('test-frame');
      const iframeContainer = document.getElementById('iframe-container');

      function log(message) {
        const timestamp = new Date().toLocaleTimeString();
        results.textContent += `[${timestamp}] ${message}\n`;
        results.scrollTop = results.scrollHeight;
        console.log(`[DEBUG] ${message}`);
      }

      function clearResults() {
        results.textContent = 'Log limpo...\n';
        iframeContainer.style.display = 'none';
      }

      function loadProjectsPage() {
        log('📋 Carregando página de projetos...');
        iframeContainer.style.display = 'block';
        iframe.src = 'http://localhost:3000/projetos';

        iframe.onload = () => {
          log('✅ Página carregada!');
          log('⏳ Aguardando elementos React carregarem (5 segundos)...');

          setTimeout(() => {
            log('🎯 Agora você pode injetar o script de debug');
          }, 5000);
        };

        iframe.onerror = () => {
          log('❌ Erro ao carregar página de projetos');
        };
      }

      function injectDebugScript() {
        try {
          log('🔧 Tentando injetar script de debug...');

          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;
          if (!iframeDoc) {
            throw new Error('Não foi possível acessar o documento do iframe');
          }

          // Script que será executado dentro do iframe
          const debugScript = `
                    (function() {
                        console.log('🔍 Debug script iniciado');
                        
                        function findAndDebugCards() {
                            // Procurar por cards com diferentes seletores
                            const selectors = [
                                '[data-testid="project-card"]',
                                '.project-card',
                                'div[style*="cursor: pointer"]',
                                'div[class*="ProjectCard"]',
                                'div[class*="Card"]',
                                '[role="button"]'
                            ];
                            
                            let allCards = [];
                            
                            selectors.forEach(selector => {
                                const cards = document.querySelectorAll(selector);
                                if (cards.length > 0) {
                                    console.log('📋 Encontrados', cards.length, 'elementos com seletor:', selector);
                                    allCards = allCards.concat(Array.from(cards));
                                }
                            });
                            
                            // Remover duplicatas
                            const uniqueCards = [...new Set(allCards)];
                            console.log('📊 Total de cards únicos:', uniqueCards.length);
                            
                            if (uniqueCards.length === 0) {
                                console.log('❌ Nenhum card encontrado');
                                console.log('🔍 Elementos na página:', document.body.outerHTML.substring(0, 1000));
                                return;
                            }
                            
                            // Debug do primeiro card
                            const firstCard = uniqueCards[0];
                            console.log('🎯 Primeiro card:', firstCard);
                            console.log('🎯 Classes:', firstCard.className);
                            console.log('🎯 Conteúdo:', firstCard.textContent.substring(0, 200));
                            console.log('🎯 Atributos onClick:', firstCard.onclick);
                            console.log('🎯 Event listeners:', getEventListeners ? getEventListeners(firstCard) : 'N/A');
                            
                            // Adicionar debug listener
                            firstCard.addEventListener('click', function(e) {
                                console.log('🖱️ CARD CLICADO!');
                                console.log('🎯 Target:', e.target);
                                console.log('🎯 CurrentTarget:', e.currentTarget);
                                console.log('🎯 DefaultPrevented:', e.defaultPrevented);
                                console.log('🔗 URL antes:', window.location.href);
                                
                                setTimeout(() => {
                                    console.log('🔗 URL após 100ms:', window.location.href);
                                }, 100);
                                
                                setTimeout(() => {
                                    console.log('🔗 URL após 1s:', window.location.href);
                                }, 1000);
                            }, true); // true = capture phase
                            
                            // Destacar visualmente
                            firstCard.style.border = '3px solid #ff0000';
                            firstCard.style.boxShadow = '0 0 15px rgba(255, 0, 0, 0.7)';
                            firstCard.style.position = 'relative';
                            firstCard.style.zIndex = '9999';
                            
                            // Adicionar texto de debug
                            const debugLabel = document.createElement('div');
                            debugLabel.textContent = '🔧 DEBUG CARD';
                            debugLabel.style.position = 'absolute';
                            debugLabel.style.top = '-10px';
                            debugLabel.style.left = '10px';
                            debugLabel.style.background = 'red';
                            debugLabel.style.color = 'white';
                            debugLabel.style.padding = '2px 8px';
                            debugLabel.style.fontSize = '12px';
                            debugLabel.style.borderRadius = '4px';
                            debugLabel.style.zIndex = '10000';
                            firstCard.appendChild(debugLabel);
                            
                            console.log('✅ Debug configurado! Clique no card destacado.');
                        }
                        
                        // Tentar encontrar cards imediatamente
                        findAndDebugCards();
                        
                        // Tentar novamente após um tempo (para componentes que carregam assincronamente)
                        setTimeout(findAndDebugCards, 2000);
                        setTimeout(findAndDebugCards, 5000);
                    })();
                `;

          // Criar e inserir script
          const script = iframeDoc.createElement('script');
          script.textContent = debugScript;
          iframeDoc.head.appendChild(script);

          log('✅ Script de debug injetado!');
          log(
            '📝 Abra o console do navegador (F12) para ver os logs detalhados'
          );
          log('🎯 Procure por um card com borda vermelha');
        } catch (error) {
          log(`❌ Erro ao injetar script: ${error.message}`);
          log('💡 Certifique-se de que a página esteja carregada primeiro');
        }
      }

      function testNavigation() {
        log('🔗 Abrindo página em nova aba para teste manual...');
        window.open('http://localhost:3000/projetos', '_blank');
        log('📝 Na nova aba:');
        log('1. Verifique se os cards aparecem');
        log('2. Clique em um card');
        log('3. Verifique se a URL muda para /projetos/:id');
        log('4. Verifique se a página de detalhamento carrega');
      }

      // Auto-load quando a página abrir
      window.onload = () => {
        log('🚀 Debug tool carregado');
        log('📋 Clique em "Carregar Página de Projetos" para começar');
      };
    </script>
  </body>
</html>
