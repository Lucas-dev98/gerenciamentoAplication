<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Navegação - Detalhes dos Projetos</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
        font-weight: 500;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      .success {
        background: #10b981;
      }
      .success:hover {
        background: #059669;
      }
      .warning {
        background: #f59e0b;
      }
      .warning:hover {
        background: #d97706;
      }
      .log {
        background: #1e293b;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        max-height: 400px;
        overflow-y: auto;
        margin: 20px 0;
      }
      .iframe-container {
        margin: 20px 0;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: none;
      }
      .status {
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
      }
      .info {
        background: #dbeafe;
        color: #1e40af;
      }
      .success-status {
        background: #d1fae5;
        color: #065f46;
      }
      .error {
        background: #fee2e2;
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🧪 Teste de Navegação - Detalhes dos Projetos</h1>

      <div class="status info">
        <span
          >🔍 Este teste verifica se o clique nos cards de projetos navega
          corretamente para a página de detalhes</span
        >
      </div>

      <div style="margin: 20px 0">
        <button class="test-btn" onclick="setupAuth()">
          🔑 1. Configurar Autenticação
        </button>
        <button class="test-btn" onclick="openProjectsPage()">
          📋 2. Abrir Página de Projetos
        </button>
        <button class="test-btn warning" onclick="testCardClick()">
          🎯 3. Testar Clique no Card
        </button>
        <button class="test-btn success" onclick="testDirectNavigation()">
          🔗 4. Testar Navegação Direta
        </button>
      </div>

      <div class="iframe-container" id="iframeContainer" style="display: none">
        <iframe id="testFrame" src=""></iframe>
      </div>

      <div class="log" id="log"></div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${timestamp}] ${message}\n`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function setupAuth() {
        log('🔑 Configurando autenticação...');

        // Limpar dados antigos
        localStorage.clear();

        // Token fresco obtido do teste
        const token =
          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NjdlMjc4NGQ4MTcxMjg4NTkyMjVmNSIsImlhdCI6MTc1MjE0ODQ4NiwiZXhwIjoxNzUyMjM0ODg2fQ.EJ-CRtHiU0c0X7VV5f-MdbCmUOsbGbn4bf4EiAahgb48';
        const user = {
          _id: '6867e2784d817128859225f5',
          email: 'l.o.bastos@live.com',
          nome: 'Lucas Bastos',
          tipo: 'administrador',
        };

        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(user));

        log('✅ Autenticação configurada');
        log('🎫 Token salvo no localStorage');
        log('👤 Usuário salvo no localStorage');
      }

      function openProjectsPage() {
        log('📋 Abrindo página de projetos...');

        const iframeContainer = document.getElementById('iframeContainer');
        const iframe = document.getElementById('testFrame');

        iframeContainer.style.display = 'block';
        iframe.src = 'http://localhost:3000/projetos';

        iframe.onload = () => {
          log('✅ Página de projetos carregada');
          log('👀 Aguarde os cards carregarem e procure por cards clicáveis');

          // Tentar configurar autenticação no iframe
          setTimeout(() => {
            try {
              const iframeWindow = iframe.contentWindow;
              if (iframeWindow) {
                iframeWindow.localStorage.setItem(
                  'token',
                  localStorage.getItem('token')
                );
                iframeWindow.localStorage.setItem(
                  'user',
                  localStorage.getItem('user')
                );
                log('🔄 Autenticação sincronizada com iframe');
                iframeWindow.location.reload();
              }
            } catch (error) {
              log(
                '⚠️ Não foi possível sincronizar autenticação (normal para iframe)'
              );
            }
          }, 1000);
        };

        iframe.onerror = () => {
          log('❌ Erro ao carregar página de projetos');
        };
      }

      function testCardClick() {
        log('🎯 Testando clique no card...');

        const iframe = document.getElementById('testFrame');

        try {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Procurar por cards clicáveis
          const cards = iframeDoc.querySelectorAll(
            '[style*="cursor: pointer"]'
          );
          log(`🔍 Encontrados ${cards.length} cards clicáveis`);

          if (cards.length > 0) {
            const firstCard = cards[0];
            log('🎯 Clicando no primeiro card...');

            // Adicionar destaque visual
            firstCard.style.border = '3px solid #ef4444';
            firstCard.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';

            // Simular clique
            firstCard.click();

            // Verificar mudança de URL após um tempo
            setTimeout(() => {
              const currentUrl = iframe.contentWindow.location.href;
              log(`📍 URL atual: ${currentUrl}`);

              if (
                currentUrl.includes('/projetos/') &&
                currentUrl !== 'http://localhost:3000/projetos'
              ) {
                log(
                  '✅ Navegação funcionou! URL mudou para página de detalhes'
                );
              } else {
                log('❌ Navegação não funcionou - URL não mudou');
              }
            }, 2000);
          } else {
            log('❌ Nenhum card clicável encontrado');
            log('💡 Dica: Verifique se a página carregou completamente');
          }
        } catch (error) {
          log(`❌ Erro ao acessar iframe: ${error.message}`);
          log('💡 Isso é normal devido às políticas de segurança do navegador');
          log('🔧 Teste manual: Clique diretamente nos cards na página acima');
        }
      }

      function testDirectNavigation() {
        log('🔗 Testando navegação direta...');

        // URLs de teste obtidas do script anterior
        const testUrls = [
          'http://localhost:3000/projetos/686beb60a09e4125315916e5',
          'http://localhost:3000/projetos/686be6a8a09e412531591603',
          'http://localhost:3000/projetos/686be5e3a09e4125315913b5',
        ];

        const iframe = document.getElementById('testFrame');
        const iframeContainer = document.getElementById('iframeContainer');

        iframeContainer.style.display = 'block';

        log(`📋 Testando ${testUrls.length} URLs de detalhes...`);

        let currentIndex = 0;

        function testNextUrl() {
          if (currentIndex >= testUrls.length) {
            log('✅ Teste de navegação direta concluído');
            return;
          }

          const url = testUrls[currentIndex];
          log(`${currentIndex + 1}. Navegando para: ${url}`);

          iframe.src = url;

          iframe.onload = () => {
            log(`   ✅ Página ${currentIndex + 1} carregada`);
            currentIndex++;

            setTimeout(testNextUrl, 3000); // Aguardar 3 segundos antes do próximo
          };

          iframe.onerror = () => {
            log(`   ❌ Erro ao carregar página ${currentIndex + 1}`);
            currentIndex++;
            setTimeout(testNextUrl, 1000);
          };
        }

        testNextUrl();
      }

      // Instruções iniciais
      log('🧪 TESTE DE NAVEGAÇÃO DOS DETALHES DOS PROJETOS');
      log('================================================');
      log('');
      log('📋 PASSOS PARA TESTAR:');
      log('1. Clique em "🔑 1. Configurar Autenticação"');
      log('2. Clique em "📋 2. Abrir Página de Projetos"');
      log('3. Aguarde os cards carregarem');
      log('4. Clique em "🎯 3. Testar Clique no Card"');
      log('5. Ou teste "🔗 4. Testar Navegação Direta"');
      log('');
      log('💡 DICAS:');
      log('- Se o iframe não funcionar, teste manualmente em nova aba');
      log('- Abra F12 no iframe para ver logs detalhados');
      log('- Os cards devem navegar para /projetos/:id ao clicar');
      log('');
    </script>
  </body>
</html>
