<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de NavegaÃ§Ã£o - Detalhes dos Projetos</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
        font-weight: 500;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      .success {
        background: #10b981;
      }
      .success:hover {
        background: #059669;
      }
      .warning {
        background: #f59e0b;
      }
      .warning:hover {
        background: #d97706;
      }
      .log {
        background: #1e293b;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        max-height: 400px;
        overflow-y: auto;
        margin: 20px 0;
      }
      .iframe-container {
        margin: 20px 0;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: none;
      }
      .status {
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
      }
      .info {
        background: #dbeafe;
        color: #1e40af;
      }
      .success-status {
        background: #d1fae5;
        color: #065f46;
      }
      .error {
        background: #fee2e2;
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª Teste de NavegaÃ§Ã£o - Detalhes dos Projetos</h1>

      <div class="status info">
        <span
          >ğŸ” Este teste verifica se o clique nos cards de projetos navega
          corretamente para a pÃ¡gina de detalhes</span
        >
      </div>

      <div style="margin: 20px 0">
        <button class="test-btn" onclick="setupAuth()">
          ğŸ”‘ 1. Configurar AutenticaÃ§Ã£o
        </button>
        <button class="test-btn" onclick="openProjectsPage()">
          ğŸ“‹ 2. Abrir PÃ¡gina de Projetos
        </button>
        <button class="test-btn warning" onclick="testCardClick()">
          ğŸ¯ 3. Testar Clique no Card
        </button>
        <button class="test-btn success" onclick="testDirectNavigation()">
          ğŸ”— 4. Testar NavegaÃ§Ã£o Direta
        </button>
      </div>

      <div class="iframe-container" id="iframeContainer" style="display: none">
        <iframe id="testFrame" src=""></iframe>
      </div>

      <div class="log" id="log"></div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${timestamp}] ${message}\n`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function setupAuth() {
        log('ğŸ”‘ Configurando autenticaÃ§Ã£o...');

        // Limpar dados antigos
        localStorage.clear();

        // Token fresco obtido do teste
        const token =
          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NjdlMjc4NGQ4MTcxMjg4NTkyMjVmNSIsImlhdCI6MTc1MjE0ODQ4NiwiZXhwIjoxNzUyMjM0ODg2fQ.EJ-CRtHiU0c0X7VV5f-MdbCmUOsbGbn4bf4EiAahgb48';
        const user = {
          _id: '6867e2784d817128859225f5',
          email: 'l.o.bastos@live.com',
          nome: 'Lucas Bastos',
          tipo: 'administrador',
        };

        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(user));

        log('âœ… AutenticaÃ§Ã£o configurada');
        log('ğŸ« Token salvo no localStorage');
        log('ğŸ‘¤ UsuÃ¡rio salvo no localStorage');
      }

      function openProjectsPage() {
        log('ğŸ“‹ Abrindo pÃ¡gina de projetos...');

        const iframeContainer = document.getElementById('iframeContainer');
        const iframe = document.getElementById('testFrame');

        iframeContainer.style.display = 'block';
        iframe.src = 'http://localhost:3000/projetos';

        iframe.onload = () => {
          log('âœ… PÃ¡gina de projetos carregada');
          log('ğŸ‘€ Aguarde os cards carregarem e procure por cards clicÃ¡veis');

          // Tentar configurar autenticaÃ§Ã£o no iframe
          setTimeout(() => {
            try {
              const iframeWindow = iframe.contentWindow;
              if (iframeWindow) {
                iframeWindow.localStorage.setItem(
                  'token',
                  localStorage.getItem('token')
                );
                iframeWindow.localStorage.setItem(
                  'user',
                  localStorage.getItem('user')
                );
                log('ğŸ”„ AutenticaÃ§Ã£o sincronizada com iframe');
                iframeWindow.location.reload();
              }
            } catch (error) {
              log(
                'âš ï¸ NÃ£o foi possÃ­vel sincronizar autenticaÃ§Ã£o (normal para iframe)'
              );
            }
          }, 1000);
        };

        iframe.onerror = () => {
          log('âŒ Erro ao carregar pÃ¡gina de projetos');
        };
      }

      function testCardClick() {
        log('ğŸ¯ Testando clique no card...');

        const iframe = document.getElementById('testFrame');

        try {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Procurar por cards clicÃ¡veis
          const cards = iframeDoc.querySelectorAll(
            '[style*="cursor: pointer"]'
          );
          log(`ğŸ” Encontrados ${cards.length} cards clicÃ¡veis`);

          if (cards.length > 0) {
            const firstCard = cards[0];
            log('ğŸ¯ Clicando no primeiro card...');

            // Adicionar destaque visual
            firstCard.style.border = '3px solid #ef4444';
            firstCard.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';

            // Simular clique
            firstCard.click();

            // Verificar mudanÃ§a de URL apÃ³s um tempo
            setTimeout(() => {
              const currentUrl = iframe.contentWindow.location.href;
              log(`ğŸ“ URL atual: ${currentUrl}`);

              if (
                currentUrl.includes('/projetos/') &&
                currentUrl !== 'http://localhost:3000/projetos'
              ) {
                log(
                  'âœ… NavegaÃ§Ã£o funcionou! URL mudou para pÃ¡gina de detalhes'
                );
              } else {
                log('âŒ NavegaÃ§Ã£o nÃ£o funcionou - URL nÃ£o mudou');
              }
            }, 2000);
          } else {
            log('âŒ Nenhum card clicÃ¡vel encontrado');
            log('ğŸ’¡ Dica: Verifique se a pÃ¡gina carregou completamente');
          }
        } catch (error) {
          log(`âŒ Erro ao acessar iframe: ${error.message}`);
          log('ğŸ’¡ Isso Ã© normal devido Ã s polÃ­ticas de seguranÃ§a do navegador');
          log('ğŸ”§ Teste manual: Clique diretamente nos cards na pÃ¡gina acima');
        }
      }

      function testDirectNavigation() {
        log('ğŸ”— Testando navegaÃ§Ã£o direta...');

        // URLs de teste obtidas do script anterior
        const testUrls = [
          'http://localhost:3000/projetos/686beb60a09e4125315916e5',
          'http://localhost:3000/projetos/686be6a8a09e412531591603',
          'http://localhost:3000/projetos/686be5e3a09e4125315913b5',
        ];

        const iframe = document.getElementById('testFrame');
        const iframeContainer = document.getElementById('iframeContainer');

        iframeContainer.style.display = 'block';

        log(`ğŸ“‹ Testando ${testUrls.length} URLs de detalhes...`);

        let currentIndex = 0;

        function testNextUrl() {
          if (currentIndex >= testUrls.length) {
            log('âœ… Teste de navegaÃ§Ã£o direta concluÃ­do');
            return;
          }

          const url = testUrls[currentIndex];
          log(`${currentIndex + 1}. Navegando para: ${url}`);

          iframe.src = url;

          iframe.onload = () => {
            log(`   âœ… PÃ¡gina ${currentIndex + 1} carregada`);
            currentIndex++;

            setTimeout(testNextUrl, 3000); // Aguardar 3 segundos antes do prÃ³ximo
          };

          iframe.onerror = () => {
            log(`   âŒ Erro ao carregar pÃ¡gina ${currentIndex + 1}`);
            currentIndex++;
            setTimeout(testNextUrl, 1000);
          };
        }

        testNextUrl();
      }

      // InstruÃ§Ãµes iniciais
      log('ğŸ§ª TESTE DE NAVEGAÃ‡ÃƒO DOS DETALHES DOS PROJETOS');
      log('================================================');
      log('');
      log('ğŸ“‹ PASSOS PARA TESTAR:');
      log('1. Clique em "ğŸ”‘ 1. Configurar AutenticaÃ§Ã£o"');
      log('2. Clique em "ğŸ“‹ 2. Abrir PÃ¡gina de Projetos"');
      log('3. Aguarde os cards carregarem');
      log('4. Clique em "ğŸ¯ 3. Testar Clique no Card"');
      log('5. Ou teste "ğŸ”— 4. Testar NavegaÃ§Ã£o Direta"');
      log('');
      log('ğŸ’¡ DICAS:');
      log('- Se o iframe nÃ£o funcionar, teste manualmente em nova aba');
      log('- Abra F12 no iframe para ver logs detalhados');
      log('- Os cards devem navegar para /projetos/:id ao clicar');
      log('');
    </script>
  </body>
</html>
